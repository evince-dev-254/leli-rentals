module.exports=[59315,(a,b,c)=>{var d;a.e,d=a.r(72131),b.exports=function(a){var b={};function c(d){if(b[d])return b[d].exports;var e=b[d]={i:d,l:!1,exports:{}};return a[d].call(e.exports,e,e.exports,c),e.l=!0,e.exports}return c.m=a,c.c=b,c.d=function(a,b,d){c.o(a,b)||Object.defineProperty(a,b,{enumerable:!0,get:d})},c.r=function(a){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},c.t=function(a,b){if(1&b&&(a=c(a)),8&b||4&b&&"object"==typeof a&&a&&a.__esModule)return a;var d=Object.create(null);if(c.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:a}),2&b&&"string"!=typeof a)for(var e in a)c.d(d,e,(function(b){return a[b]}).bind(null,e));return d},c.n=function(a){var b=a&&a.__esModule?function(){return a.default}:function(){return a};return c.d(b,"a",b),b},c.o=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)},c.p="",c(c.s="./src/react-webcam.tsx")}({"./src/react-webcam.tsx":function(a,b,c){"use strict";c.r(b);var d,e=c("react"),f=(d=function(a,b){return(d=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(a,b){a.__proto__=b}||function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c])})(a,b)},function(a,b){function c(){this.constructor=a}d(a,b),a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)}),g=function(){return(g=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)},h=function(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&0>b.indexOf(d)&&(c[d]=a[d]);if(null!=a&&"function"==typeof Object.getOwnPropertySymbols)for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++)0>b.indexOf(d[e])&&Object.prototype.propertyIsEnumerable.call(a,d[e])&&(c[d[e]]=a[d[e]]);return c};function i(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}b.default=function(a){function b(b){var c=a.call(this,b)||this;return c.canvas=null,c.ctx=null,c.requestUserMediaId=0,c.unmounted=!1,c.state={hasUserMedia:!1},c}return f(b,a),b.prototype.componentDidMount=function(){var a=this.state,b=this.props;(this.unmounted=!1,i())?(a.hasUserMedia||this.requestUserMedia(),b.children&&"function"!=typeof b.children&&console.warn("children must be a function")):b.onUserMediaError("getUserMedia not supported")},b.prototype.componentDidUpdate=function(a){var b=this.props;if(!i())return void b.onUserMediaError("getUserMedia not supported");var c=JSON.stringify(a.audioConstraints)!==JSON.stringify(b.audioConstraints),d=JSON.stringify(a.videoConstraints)!==JSON.stringify(b.videoConstraints),e=a.minScreenshotWidth!==b.minScreenshotWidth,f=a.minScreenshotHeight!==b.minScreenshotHeight;(d||e||f)&&(this.canvas=null,this.ctx=null),(c||d)&&(this.stopAndCleanup(),this.requestUserMedia())},b.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},b.stopMediaStream=function(a){a&&(a.getVideoTracks&&a.getAudioTracks?(a.getVideoTracks().map(function(b){a.removeTrack(b),b.stop()}),a.getAudioTracks().map(function(b){a.removeTrack(b),b.stop()})):a.stop())},b.prototype.stopAndCleanup=function(){var a=this.state;a.hasUserMedia&&(b.stopMediaStream(this.stream),a.src&&window.URL.revokeObjectURL(a.src))},b.prototype.getScreenshot=function(a){var b=this.state,c=this.props;if(!b.hasUserMedia)return null;var d=this.getCanvas(a);return d&&d.toDataURL(c.screenshotFormat,c.screenshotQuality)},b.prototype.getCanvas=function(a){var b=this.state,c=this.props;if(!this.video||!b.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var d=this.video.videoWidth,e=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var f=d/e;e=(d=c.minScreenshotWidth||this.video.clientWidth)/f,c.minScreenshotHeight&&e<c.minScreenshotHeight&&(d=(e=c.minScreenshotHeight)*f)}this.canvas=document.createElement("canvas"),this.canvas.width=(null==a?void 0:a.width)||d,this.canvas.height=(null==a?void 0:a.height)||e,this.ctx=this.canvas.getContext("2d")}var g=this.ctx,h=this.canvas;return g&&h&&(h.width=(null==a?void 0:a.width)||h.width,h.height=(null==a?void 0:a.height)||h.height,c.mirrored&&(g.translate(h.width,0),g.scale(-1,1)),g.imageSmoothingEnabled=c.imageSmoothing,g.drawImage(this.video,0,0,(null==a?void 0:a.width)||h.width,(null==a?void 0:a.height)||h.height),c.mirrored&&(g.scale(-1,1),g.translate(-h.width,0))),h},b.prototype.requestUserMedia=function(){var a=this,c=this.props,d=function(d,e){var f={video:void 0===e||e};c.audio&&(f.audio=void 0===d||d),a.requestUserMediaId++;var g=a.requestUserMediaId;navigator.mediaDevices.getUserMedia(f).then(function(c){a.unmounted||g!==a.requestUserMediaId?b.stopMediaStream(c):a.handleUserMedia(null,c)}).catch(function(b){a.handleUserMedia(b)})};if("mediaDevices"in navigator)d(c.audioConstraints,c.videoConstraints);else{var e=function(a){return{optional:[{sourceId:a}]}},f=function(a){var b=a.deviceId;return"string"==typeof b?b:Array.isArray(b)&&b.length>0?b[0]:"object"==typeof b&&b.ideal?b.ideal:null};MediaStreamTrack.getSources(function(a){var b=null,g=null;a.forEach(function(a){"audio"===a.kind?b=a.id:"video"===a.kind&&(g=a.id)});var h=f(c.audioConstraints);h&&(b=h);var i=f(c.videoConstraints);i&&(g=i),d(e(b),e(g))})}},b.prototype.handleUserMedia=function(a,b){var c=this.props;if(a||!b){this.setState({hasUserMedia:!1}),c.onUserMediaError(a);return}this.stream=b;try{this.video&&(this.video.srcObject=b),this.setState({hasUserMedia:!0})}catch(a){this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(b)})}c.onUserMedia(b)},b.prototype.render=function(){var a=this,b=this.state,c=this.props,d=c.audio,f=(c.forceScreenshotSourceSize,c.disablePictureInPicture),i=(c.onUserMedia,c.onUserMediaError,c.screenshotFormat,c.screenshotQuality,c.minScreenshotWidth,c.minScreenshotHeight,c.audioConstraints,c.videoConstraints,c.imageSmoothing,c.mirrored),j=c.style,k=void 0===j?{}:j,l=c.children,m=h(c,["audio","forceScreenshotSourceSize","disablePictureInPicture","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),n=i?g(g({},k),{transform:(k.transform||"")+" scaleX(-1)"}):k,o={getScreenshot:this.getScreenshot.bind(this)};return e.createElement(e.Fragment,null,e.createElement("video",g({autoPlay:!0,disablePictureInPicture:f,src:b.src,muted:!d,playsInline:!0,ref:function(b){a.video=b},style:n},m)),l&&l(o))},b.defaultProps={audio:!1,disablePictureInPicture:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},b}(e.Component)},react:function(a,b){a.exports=d}}).default},19211,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(59315),e=a.i(73320),f=a.i(4720),g=a.i(16201),h=a.i(73570),i=a.i(33508),j=a.i(96221),k=a.i(13513);let l=(0,a.i(70106).default)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);var m=a.i(3130),n=a.i(40695),o=a.i(54161),p=a.i(17171),q=a.i(5522),r=a.i(87682),s=a.i(78560),t=a.i(42521),u=a.i(23292),v=a.i(71294);function w(){let[a,w]=(0,c.useState)([]),[x,y]=(0,c.useState)(!0),[z,A]=(0,c.useState)(!1),[B,C]=(0,c.useState)("id_card"),[D,E]=(0,c.useState)(""),[F,G]=(0,c.useState)(""),[H,I]=(0,c.useState)(""),[J,K]=(0,c.useState)(""),[L,M]=(0,c.useState)(""),[N,O]=(0,c.useState)(""),[P,Q]=(0,c.useState)(""),[R,S]=(0,c.useState)(""),[T,U]=(0,c.useState)(!1),V=(0,c.useRef)(null),[W,X]=(0,c.useState)(!1),Y=async()=>{try{let{data:{user:a}}=await s.supabase.auth.getUser();if(a){let b=await (0,t.getVerifications)(a.id);w(b||[]);let{data:c}=await s.supabase.from("user_profiles").select("*").eq("id",a.id).single();c&&(M(c.date_of_birth||""),O(c.next_of_kin_name||""),Q(c.next_of_kin_relationship||""),S(c.next_of_kin_phone||""))}}catch(a){console.error("Error fetching documents:",a)}finally{y(!1)}};(0,c.useEffect)(()=>{Y()},[]);let Z=async()=>{if(D&&F&&H){A(!0);try{let{data:{user:a}}=await s.supabase.auth.getUser();if(!a)return;await (0,t.updateProfile)(a.id,{date_of_birth:L,next_of_kin_name:N,next_of_kin_relationship:P,next_of_kin_phone:R}),await (0,t.uploadVerification)(a.id,D,F,H,B,J),u.toast.success("Verification submitted successfully"),await Y(),E(""),G(""),I(""),K("")}catch(a){console.error("Error uploading:",a)}finally{A(!1)}}},$=(0,c.useCallback)(async()=>{let a=V.current?.getScreenshot();if(a){X(!0);try{let b=await fetch("/api/imagekit/auth");if(!b.ok)throw Error("Failed to get auth params");let{signature:c,expire:d,token:e}=await b.json(),f=await fetch(a),g=await f.blob(),h=new File([g],"selfie.jpg",{type:"image/jpeg"}),i=new FormData;i.append("file",h),i.append("fileName","selfie.jpg"),i.append("publicKey","public_qvHAZC5VBwvFfMvF6CxulrvgOlM="),i.append("signature",c),i.append("expire",d),i.append("token",e),i.append("folder","/verification-docs");let j=await fetch("https://upload.imagekit.io/api/v1/files/upload",{method:"POST",body:i});if(!j.ok){let a=await j.text();throw Error(`Upload failed: ${a}`)}let k=await j.json();I(k.url),U(!1)}catch(a){console.error("Selfie upload error:",a)}finally{X(!1)}}},[V]),_=new Date;_.setDate(_.getDate()+3);let aa=a.some(a=>"approved"===a.status);return(a.some(a=>"pending"===a.status),x)?(0,b.jsx)("div",{className:"flex justify-center p-20",children:(0,b.jsx)(j.Loader2,{className:"animate-spin h-8 w-8 text-primary"})}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold",children:"Verification"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Complete your account verification to start listing"})]}),(0,b.jsx)(m.Card,{className:`border-l-4 ${aa?"border-l-green-500 bg-green-500/5":"border-l-orange-500 bg-orange-500/5"}`,children:(0,b.jsx)(m.CardContent,{className:"pt-6",children:(0,b.jsxs)("div",{className:"flex items-start gap-4",children:[(0,b.jsx)("div",{className:`p-3 rounded-full ${aa?"bg-green-500/10":"bg-orange-500/10"}`,children:aa?(0,b.jsx)(g.CheckCircle,{className:"h-6 w-6 text-green-500"}):(0,b.jsx)(h.AlertTriangle,{className:"h-6 w-6 text-orange-500"})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h3",{className:`font-semibold mb-1 ${aa?"text-green-600":"text-orange-600"}`,children:aa?"Verification Complete":"Verification Pending"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mb-3",children:aa?"Your account is fully verified. You can now list items and accept bookings.":"Submit all required documents to verify your identity."})]})]})})}),(0,b.jsxs)("div",{className:"grid gap-6 md:grid-cols-2",children:[(0,b.jsxs)(m.Card,{className:"glass-card",children:[(0,b.jsxs)(m.CardHeader,{children:[(0,b.jsx)(m.CardTitle,{children:"Personal Information"}),(0,b.jsx)(m.CardDescription,{children:"Your details as per ID"})]}),(0,b.jsx)(m.CardContent,{className:"space-y-4",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(p.Label,{children:"Date of Birth"}),(0,b.jsx)(q.Input,{type:"date",value:L,onChange:a=>M(a.target.value)})]})})]}),(0,b.jsxs)(m.Card,{className:"glass-card",children:[(0,b.jsxs)(m.CardHeader,{children:[(0,b.jsx)(m.CardTitle,{children:"Next of Kin"}),(0,b.jsx)(m.CardDescription,{children:"Emergency contact details"})]}),(0,b.jsxs)(m.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(p.Label,{children:"Full Name"}),(0,b.jsx)(q.Input,{placeholder:"e.g. Jane Doe",value:N,onChange:a=>O(a.target.value)})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(p.Label,{children:"Relationship"}),(0,b.jsx)(q.Input,{placeholder:"e.g. Spouse",value:P,onChange:a=>Q(a.target.value)})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(p.Label,{children:"Phone Number"}),(0,b.jsx)(q.Input,{placeholder:"+254...",value:R,onChange:a=>S(a.target.value)})]})]})]})]})]}),(0,b.jsxs)(m.Card,{className:"glass-card",children:[(0,b.jsxs)(m.CardHeader,{children:[(0,b.jsx)(m.CardTitle,{children:"Submitted Documents"}),(0,b.jsx)(m.CardDescription,{children:"Documents you have uploaded for verification"})]}),(0,b.jsx)(m.CardContent,{children:0===a.length?(0,b.jsx)("p",{className:"text-center text-muted-foreground py-4",children:"No documents submitted yet."}):(0,b.jsx)("div",{className:"space-y-4",children:a.map(a=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 rounded-lg bg-background/50 border border-border",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:"p-2 rounded-lg bg-primary/10",children:(0,b.jsx)(f.FileText,{className:"h-5 w-5 text-primary"})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium capitalize",children:a.document_type.replace("_"," ")}),(0,b.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,b.jsx)("a",{href:a.document_url,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-500 hover:underline",children:"View Front"}),a.back_image_url&&(0,b.jsx)("a",{href:a.back_image_url,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-500 hover:underline",children:"View Back"}),a.selfie_image_url&&(0,b.jsx)("a",{href:a.selfie_image_url,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-500 hover:underline",children:"View Selfie"})]})]})]}),(0,b.jsx)("div",{className:"flex items-center gap-3",children:(0,b.jsx)(o.Badge,{className:`${"approved"===a.status?"bg-green-500":"bg-orange-500"}`,children:a.status})})]},a.id))})})]}),(0,b.jsxs)(m.Card,{className:"glass-card",children:[(0,b.jsxs)(m.CardHeader,{children:[(0,b.jsx)(m.CardTitle,{children:"submit Documents"}),(0,b.jsx)(m.CardDescription,{children:"Submit required verification documents"})]}),(0,b.jsxs)(m.CardContent,{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(p.Label,{children:"Document Type"}),(0,b.jsxs)(r.Select,{value:B,onValueChange:C,children:[(0,b.jsx)(r.SelectTrigger,{children:(0,b.jsx)(r.SelectValue,{placeholder:"Select type"})}),(0,b.jsxs)(r.SelectContent,{children:[(0,b.jsx)(r.SelectItem,{value:"id_card",children:"National ID"}),(0,b.jsx)(r.SelectItem,{value:"passport",children:"Passport"}),(0,b.jsx)(r.SelectItem,{value:"drivers_license",children:"Driver's License"}),(0,b.jsx)(r.SelectItem,{value:"business_license",children:"Business License"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(p.Label,{children:"Document Number"}),(0,b.jsx)(q.Input,{placeholder:"Enter ID/Passport Number",value:J,onChange:a=>K(a.target.value)})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(p.Label,{children:"Front of Document"}),(0,b.jsx)(v.ImageUpload,{folder:"/verification-docs",onSuccess:a=>E(a.url),onError:a=>console.error("Front upload error",a),className:"w-full",buttonText:"Upload Front",variant:"outline",maxSizeMB:10}),D&&(0,b.jsx)("p",{className:"text-xs text-green-600",children:"Front uploaded"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(p.Label,{children:"Back of Document"}),(0,b.jsx)(v.ImageUpload,{folder:"/verification-docs",onSuccess:a=>G(a.url),onError:a=>console.error("Back upload error",a),className:"w-full",buttonText:"Upload Back",variant:"outline",maxSizeMB:10}),F&&(0,b.jsx)("p",{className:"text-xs text-green-600",children:"Back uploaded"})]}),(0,b.jsxs)("div",{className:"space-y-2 md:col-span-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,b.jsx)(p.Label,{children:"Selfie Holding ID"}),(0,b.jsx)(n.Button,{variant:"outline",size:"sm",onClick:()=>U(!T),type:"button",children:T?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(e.Upload,{className:"w-4 h-4 mr-2"})," Upload File"]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(k.Camera,{className:"w-4 h-4 mr-2"})," Use Camera"]})})]}),T?(0,b.jsx)("div",{className:"relative rounded-lg overflow-hidden border bg-black aspect-video flex items-center justify-center",children:H?(0,b.jsxs)("div",{className:"relative w-full h-full",children:[(0,b.jsx)("img",{src:H,alt:"Selfie",className:"w-full h-full object-cover"}),(0,b.jsx)("div",{className:"absolute bottom-4 left-0 right-0 flex justify-center gap-2",children:(0,b.jsxs)(n.Button,{variant:"secondary",size:"sm",onClick:()=>I(""),children:[(0,b.jsx)(l,{className:"mr-2 h-4 w-4"})," Retake"]})})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(d.default,{audio:!1,ref:V,screenshotFormat:"image/jpeg",className:"w-full h-full object-cover",videoConstraints:{facingMode:"user"},mirrored:!0,playsInline:!0,muted:!0,onUserMediaError:a=>console.error("Webcam error:",a)}),(0,b.jsx)("div",{className:"absolute bottom-4 left-0 right-0 flex justify-center",children:(0,b.jsxs)(n.Button,{onClick:$,disabled:W,children:[W?(0,b.jsx)(j.Loader2,{className:"animate-spin mr-2"}):(0,b.jsx)(k.Camera,{className:"mr-2 h-4 w-4"}),W?"Uploading...":"Take Photo"]})})]})}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(v.ImageUpload,{folder:"/verification-docs",onSuccess:a=>I(a.url),onError:a=>console.error("Selfie upload error",a),className:"w-full",buttonText:"Upload Selfie",variant:"outline",maxSizeMB:10}),H&&(0,b.jsxs)("div",{className:"mt-2 relative aspect-video w-40 rounded-md overflow-hidden border",children:[(0,b.jsx)("img",{src:H,alt:"Selfie",className:"w-full h-full object-cover"}),(0,b.jsx)(n.Button,{variant:"destructive",size:"icon",className:"absolute top-1 right-1 h-6 w-6",onClick:()=>I(""),children:(0,b.jsx)(i.X,{className:"h-3 w-3"})})]})]}),!H&&!T&&(0,b.jsx)("p",{className:"text-xs text-green-600 hidden",children:"Selfie uploaded"}),H&&!T&&(0,b.jsx)("p",{className:"text-xs text-green-600",children:"Selfie ready"})]})]}),(0,b.jsx)(n.Button,{className:"w-full",onClick:Z,disabled:z||!D||!F||!H||!J||!L,children:z?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(j.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Submitting..."]}):"Submit Verification"}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-2 text-center",children:"PNG, JPG, PDF (max 10MB each)"})]})]})]})}a.s(["VerificationPage",()=>w],19211)}];

//# sourceMappingURL=_d7d12f30._.js.map