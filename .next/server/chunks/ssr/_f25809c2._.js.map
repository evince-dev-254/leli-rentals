{"version":3,"sources":["../../../../node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts","../../../../node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts","../../../../lib/supabase.ts","../../../../lib/actions/booking-actions.ts"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n","// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n","import { createClient } from '@supabase/supabase-js';\r\n\r\nexport const supabase = createClient(\r\n    process.env.NEXT_PUBLIC_SUPABASE_URL ?? '',\r\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY ?? ''\r\n);\r\n","\"use server\"\r\n\r\nimport { supabase } from \"@/lib/supabase\"\r\nimport { sendBookingConfirmationEmail } from \"@/lib/actions/email-actions\"\r\n\r\ninterface BookingData {\r\n    listing_id: string\r\n    renter_id: string\r\n    owner_id: string\r\n    start_date: string\r\n    end_date: string\r\n    total_days: number\r\n    price_per_day: number\r\n    subtotal: number\r\n    service_fee: number\r\n    total_amount: number\r\n    payment_status: \"pending\" | \"paid\"\r\n    status: \"pending\" | \"confirmed\"\r\n}\r\n\r\nexport async function createBooking(bookingData: BookingData, userEmail: string, userName: string, listingTitle: string) {\r\n    console.log(\"Creating booking:\", bookingData)\r\n\r\n    try {\r\n        const { data, error } = await supabase\r\n            .from(\"bookings\")\r\n            .insert(bookingData)\r\n            .select()\r\n            .single()\r\n\r\n        if (error) {\r\n            console.error(\"Error creating booking:\", error)\r\n            throw error\r\n        }\r\n\r\n        console.log(\"Booking created:\", data.id)\r\n\r\n        // If booking is confirmed/paid, send confirmation email\r\n        if (bookingData.status === \"confirmed\" || bookingData.payment_status === \"paid\") {\r\n            try {\r\n                await sendBookingConfirmationEmail(\r\n                    userEmail,\r\n                    userName.split(\" \")[0], // First name\r\n                    listingTitle,\r\n                    new Date(bookingData.start_date).toLocaleDateString(),\r\n                    new Date(bookingData.end_date).toLocaleDateString(),\r\n                    bookingData.total_amount,\r\n                    data.id\r\n                )\r\n            } catch (emailErr) {\r\n                console.error(\"Failed to send booking email:\", emailErr)\r\n            }\r\n        }\r\n\r\n        return { success: true, booking: data }\r\n    } catch (err: any) {\r\n        return { success: false, error: err.message }\r\n    }\r\n}\r\n"],"names":["registerServerReference","ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"6CAAoD,OAAA,cAAA,CAAA,EAAA,aAAA,oCAC3CA,0BAAAA,qCAAAA,EAAAA,uBAAuB,YAAQ,CAAA,CAAA,IAAA,iCCEjC,SAASC,EAAyBC,CAAc,EACrD,IAAK,IAAIC,EAAI,EAAGA,EAAID,EAAQE,MAAM,CAAED,IAAK,CACvC,IAAME,EAASH,CAAO,CAACC,EAAE,CACzB,GAAsB,YAAlB,AAA8B,OAAvBE,EACT,MAAM,OAAA,cAEL,CAFK,AAAIC,MACR,CAAC,2DAA2D,EAAE,OAAOD,EAAO;AAAA,oEAAuE,CAAC,EADhJ,oBAAA,OAAA,mBAAA,gBAAA,CAEN,EAEJ,CACF,0EATgBJ,2BAAAA,qCAAAA,6BCDT,IAAM,EAAW,CAAA,EAAA,AAFxB,EAAA,CAAA,CAAA,OAEwB,YAAA,AAAY,EAChC,2CACA,IADwC,IACxC,+MAA6C,4DCFjD,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAiBO,eAAe,EAAc,CAAwB,CAAE,CAAiB,CAAE,CAAgB,CAAE,CAAoB,EACnH,QAAQ,GAAG,CAAC,oBAAqB,GAEjC,GAAI,CACA,GAAM,CAAE,MAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAAA,QAAQ,CACjC,IAAI,CAAC,YACL,MAAM,CAAC,GACP,MAAM,GACN,MAAM,GAEX,GAAI,EAEA,KAFO,CACP,QAAQ,KAAK,CAAC,0BAA2B,GACnC,EAMV,GAHA,QAAQ,GAAG,CAAC,mBAAoB,EAAK,EAAE,EAGZ,cAAvB,EAAY,MAAM,EAAmD,QAAQ,CAAvC,EAAY,cAAc,CAChE,GAAI,CACA,MAAM,CAAA,EAAA,EAAA,4BAAA,AAA4B,EAC9B,EACA,EAAS,KAAK,CAAC,IAAI,CAAC,EAAE,CACtB,EACA,IAAI,KAAK,EAAY,UAAU,EAAE,kBAAkB,GACnD,IAAI,KAAK,EAAY,QAAQ,EAAE,kBAAkB,GACjD,EAAY,YAAY,CACxB,EAAK,EAAE,CAEf,CAAE,MAAO,EAAU,CACf,QAAQ,KAAK,CAAC,gCAAiC,EACnD,CAGJ,MAAO,CAAE,SAAS,EAAM,QAAS,CAAK,CAC1C,CAAE,MAAO,EAAU,CACf,MAAO,CAAE,SAAS,EAAO,MAAO,EAAI,OAAO,AAAC,CAChD,CACJ,0CAtCsB,IAAA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA","ignoreList":[0,1]}