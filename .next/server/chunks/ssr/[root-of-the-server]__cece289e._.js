module.exports=[62213,a=>{"use strict";let b=(0,a.i(70106).default)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);a.s(["default",()=>b])},42602,(a,b,c)=>{"use strict";b.exports=a.r(18622)},87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},72131,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].React},35112,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactDOM},38783,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactServerDOMTurbopackClient},9270,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.AppRouterContext},18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},36313,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HooksClientContext},18341,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.ServerInsertedHtml},41997,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={BailoutToCSRError:function(){return g},isBailoutToCSRError:function(){return h}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f="BAILOUT_TO_CLIENT_SIDE_RENDERING";class g extends Error{constructor(a){super(`Bail out to client-side rendering: ${a}`),this.reason=a,this.digest=f}}function h(a){return"object"==typeof a&&null!==a&&"digest"in a&&a.digest===f}},33508,a=>{"use strict";var b=a.i(62213);a.s(["X",()=>b.default])},4601,a=>{"use strict";var b=a.i(87924),c=a.i(72131);let d=(0,c.createContext)(void 0);function e({children:a}){let[e,f]=(0,c.useState)([]);(0,c.useEffect)(()=>{let a=localStorage.getItem("leli-favorites");a&&f(JSON.parse(a))},[]),(0,c.useEffect)(()=>{localStorage.setItem("leli-favorites",JSON.stringify(e))},[e]);let g=a=>{f(b=>[...b,a])},h=a=>{f(b=>b.filter(b=>b!==a))},i=a=>e.includes(a);return(0,b.jsx)(d.Provider,{value:{favorites:e,addFavorite:g,removeFavorite:h,isFavorite:i,toggleFavorite:a=>{i(a)?h(a):g(a)}},children:a})}function f(){let a=(0,c.useContext)(d);if(!a)throw Error("useFavorites must be used within a FavoritesProvider");return a}a.s(["FavoritesProvider",()=>e,"useFavorites",()=>f])},13902,a=>{"use strict";var b=a.i(72131),c=(a,b,c,d,e,f,g,h)=>{let i=document.documentElement,j=["light","dark"];function k(b){var c;(Array.isArray(a)?a:[a]).forEach(a=>{let c="class"===a,d=c&&f?e.map(a=>f[a]||a):e;c?(i.classList.remove(...d),i.classList.add(f&&f[b]?f[b]:b)):i.setAttribute(a,b)}),c=b,h&&j.includes(c)&&(i.style.colorScheme=c)}if(d)k(d);else try{let a=localStorage.getItem(b)||c,d=g&&"system"===a?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":a;k(d)}catch(a){}},d=["light","dark"],e="(prefers-color-scheme: dark)",f=b.createContext(void 0),g={setTheme:a=>{},themes:[]},h=()=>{var a;return null!=(a=b.useContext(f))?a:g},i=a=>b.useContext(f)?b.createElement(b.Fragment,null,a.children):b.createElement(k,{...a}),j=["light","dark"],k=({forcedTheme:a,disableTransitionOnChange:c=!1,enableSystem:g=!0,enableColorScheme:h=!0,storageKey:i="theme",themes:k=j,defaultTheme:p=g?"system":"light",attribute:q="data-theme",value:r,children:s,nonce:t,scriptProps:u})=>{let[v,w]=b.useState(()=>m(i,p)),[x,y]=b.useState(()=>"system"===v?o():v),z=r?Object.values(r):k,A=b.useCallback(a=>{let b=a;if(!b)return;"system"===a&&g&&(b=o());let e=r?r[b]:b,f=c?n(t):null,i=document.documentElement,j=a=>{"class"===a?(i.classList.remove(...z),e&&i.classList.add(e)):a.startsWith("data-")&&(e?i.setAttribute(a,e):i.removeAttribute(a))};if(Array.isArray(q)?q.forEach(j):j(q),h){let a=d.includes(p)?p:null,c=d.includes(b)?b:a;i.style.colorScheme=c}null==f||f()},[t]),B=b.useCallback(a=>{let b="function"==typeof a?a(v):a;w(b);try{localStorage.setItem(i,b)}catch(a){}},[v]),C=b.useCallback(b=>{y(o(b)),"system"===v&&g&&!a&&A("system")},[v,a]);b.useEffect(()=>{let a=window.matchMedia(e);return a.addListener(C),C(a),()=>a.removeListener(C)},[C]),b.useEffect(()=>{let a=a=>{a.key===i&&(a.newValue?w(a.newValue):B(p))};return window.addEventListener("storage",a),()=>window.removeEventListener("storage",a)},[B]),b.useEffect(()=>{A(null!=a?a:v)},[a,v]);let D=b.useMemo(()=>({theme:v,setTheme:B,forcedTheme:a,resolvedTheme:"system"===v?x:v,themes:g?[...k,"system"]:k,systemTheme:g?x:void 0}),[v,B,a,x,g,k]);return b.createElement(f.Provider,{value:D},b.createElement(l,{forcedTheme:a,storageKey:i,attribute:q,enableSystem:g,enableColorScheme:h,defaultTheme:p,value:r,themes:k,nonce:t,scriptProps:u}),s)},l=b.memo(({forcedTheme:a,storageKey:d,attribute:e,enableSystem:f,enableColorScheme:g,defaultTheme:h,value:i,themes:j,nonce:k,scriptProps:l})=>{let m=JSON.stringify([e,d,h,a,j,i,f,g]).slice(1,-1);return b.createElement("script",{...l,suppressHydrationWarning:!0,nonce:k,dangerouslySetInnerHTML:{__html:`(${c.toString()})(${m})`}})}),m=(a,b)=>{},n=a=>{let b=document.createElement("style");return a&&b.setAttribute("nonce",a),b.appendChild(document.createTextNode("*,*::before,*::after{-webkit-transition:none!important;-moz-transition:none!important;-o-transition:none!important;-ms-transition:none!important;transition:none!important}")),document.head.appendChild(b),()=>{window.getComputedStyle(document.body),setTimeout(()=>{document.head.removeChild(b)},1)}},o=a=>(a||(a=window.matchMedia(e)),a.matches?"dark":"light");a.s(["ThemeProvider",()=>i,"useTheme",()=>h])},2254,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(78560),e=a.i(50944),f=a.i(23292);let g=(0,c.createContext)(void 0);function h({children:a}){let[h,i]=(0,c.useState)([]),[j,k]=(0,c.useState)(null),[l,m]=(0,c.useState)(null),n=(0,e.useRouter)(),o=h.reduce((a,b)=>a+b.unreadCount,0);(0,c.useEffect)(()=>{!async function(){let{data:{user:a}}=await d.supabase.auth.getUser();a&&(m(a.id),q(a.id),p(a.id))}()},[]);let p=a=>{let b=d.supabase.channel("messages_channel").on("postgres_changes",{event:"*",schema:"public",table:"messages",filter:`receiver_id=eq.${a}`},()=>{q(a)}).subscribe();return()=>{d.supabase.removeChannel(b)}},q=async a=>{try{let{data:b,error:c}=await d.supabase.from("conversations").select(`
          id,
          participant_1:user_profiles!participant_1_id(id, full_name, avatar_url),
          participant_2:user_profiles!participant_2_id(id, full_name, avatar_url),
          listing:listings(id, title, images),
          messages(id, content, created_at, sender_id, is_read)
        `).or(`participant_1_id.eq.${a},participant_2_id.eq.${a}`).order("created_at",{ascending:!1});if(c)throw c;let e=b.map(b=>{let c=b.participant_1?.id===a?b.participant_2:b.participant_1,d=b.messages||[],e=d.sort((a,b)=>new Date(b.created_at).getTime()-new Date(a.created_at).getTime())[0],f=d.filter(b=>b.sender_id!==a&&!b.is_read).length;return{id:b.id,participantId:c?.id||"unknown",participantName:c?.full_name||"Unknown User",participantAvatar:c?.avatar_url,listingId:b.listing?.id,listingTitle:b.listing?.title||"Listing",listingImage:b.listing?.images?.[0]||"",messages:d.map(c=>({id:c.id,senderId:c.sender_id,receiverId:c.sender_id===a?"me":"other",listingId:b.listing?.id,listingTitle:b.listing?.title,content:c.content,timestamp:new Date(c.created_at),read:c.is_read})).sort((a,b)=>new Date(a.timestamp).getTime()-new Date(b.timestamp).getTime()),lastMessage:e?.content||"No messages",lastMessageTime:e?new Date(e.created_at):new Date,unreadCount:f}});i(e)}catch(a){console.error("Error fetching conversations:",a)}},r=async(a,b)=>{if(!l)return;let c=h.find(b=>b.id===a);if(c)try{let{error:e}=await d.supabase.from("messages").insert({conversation_id:a,sender_id:l,receiver_id:c.participantId,content:b,is_read:!1});if(e)throw e;q(l)}catch(a){console.error("Error sending message:",a),f.toast.error("Failed to send message")}},s=async(a,b,c,e,g,h,i)=>{if(!l){f.toast.error("You must be logged in to send messages"),n.push("/sign-in");return}try{let{data:b}=await d.supabase.from("conversations").select("id").eq("listing_id",e).or(`and(participant_1_id.eq.${l},participant_2_id.eq.${a}),and(participant_1_id.eq.${a},participant_2_id.eq.${l})`).single(),c=b?.id;if(!c){let{data:b,error:f}=await d.supabase.from("conversations").insert({participant_1_id:l,participant_2_id:a,listing_id:e}).select().single();if(f)throw f;c=b.id}await r(c,i),await q(l),await d.supabase.from("conversations").select("*").eq("id",c),n.push("/messages")}catch(a){console.error("Error starting conversation:",a),f.toast.error("Failed to start conversation")}},t=async a=>{if(l){i(b=>b.map(b=>b.id===a?{...b,unreadCount:0}:b));try{await d.supabase.from("messages").update({is_read:!0}).eq("conversation_id",a).neq("sender_id",l)}catch(a){console.error("Error marking read:",a)}}};return(0,b.jsx)(g.Provider,{value:{conversations:h,activeConversation:j,setActiveConversation:k,sendMessage:r,startConversation:s,markAsRead:t,unreadTotal:o},children:a})}function i(){let a=(0,c.useContext)(g);if(!a)throw Error("useMessages must be used within a MessagesProvider");return a}a.s(["MessagesProvider",()=>h,"useMessages",()=>i])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__cece289e._.js.map