module.exports=[3130,a=>{"use strict";var b=a.i(87924),c=a.i(97895);function d({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card",className:(0,c.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",a),...d})}function e({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-header",className:(0,c.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",a),...d})}function f({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-title",className:(0,c.cn)("leading-none font-semibold",a),...d})}function g({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-description",className:(0,c.cn)("text-muted-foreground text-sm",a),...d})}function h({className:a,...d}){return(0,b.jsx)("div",{"data-slot":"card-content",className:(0,c.cn)("px-6",a),...d})}a.s(["Card",()=>d,"CardContent",()=>h,"CardDescription",()=>g,"CardHeader",()=>e,"CardTitle",()=>f])},46842,a=>{"use strict";let b=(0,a.i(70106).default)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);a.s(["User",()=>b],46842)},96221,a=>{"use strict";let b=(0,a.i(70106).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);a.s(["Loader2",()=>b],96221)},92759,a=>{"use strict";let b=(0,a.i(70106).default)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);a.s(["Send",()=>b],92759)},27260,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(3130),e=a.i(5522),f=a.i(40695),g=a.i(7706),h=a.i(87532),i=a.i(92759),j=a.i(46842),k=a.i(96221),l=a.i(78560),m=a.i(42521);function n(){let[a,n]=(0,c.useState)(null),[o,p]=(0,c.useState)(""),[q,r]=(0,c.useState)([]),[s,t]=(0,c.useState)([]),[u,v]=(0,c.useState)(!0),[w,x]=(0,c.useState)(!1),[y,z]=(0,c.useState)(null),A=(0,c.useRef)(null);(0,c.useEffect)(()=>{A.current?.scrollIntoView({behavior:"smooth"})},[s]),(0,c.useEffect)(()=>{!async function(){try{let{data:{user:a}}=await l.supabase.auth.getUser();if(z(a),a){let b=await (0,m.getConversations)(a.id);r(b||[])}}catch(a){console.error("Error fetching chats:",a)}finally{v(!1)}}()},[]),(0,c.useEffect)(()=>{if(!a)return;!async function(){x(!0);try{let b=await (0,m.getMessages)(a);t(b||[])}catch(a){console.error("Error fetching messages:",a)}finally{x(!1)}}();let b=l.supabase.channel(`conversation:${a}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`conversation_id=eq.${a}`},a=>{t(b=>[...b,a.new])}).subscribe();return()=>{l.supabase.removeChannel(b)}},[a]);let B=async()=>{if(o.trim()&&a&&y)try{let b={id:"temp-"+Date.now(),content:o,sender_id:y.id,created_at:new Date().toISOString(),is_read:!1};t(a=>[...a,b]),p(""),await (0,m.sendMessage)(a,y.id,b.content)}catch(a){console.error("Error sending message:",a)}},C=q.find(b=>b.id===a)?.otherUser;return(0,b.jsxs)("div",{className:"h-[calc(100vh-8rem)] flex flex-col md:flex-row gap-6",children:[(0,b.jsxs)(d.Card,{className:"glass-card w-full md:w-80 flex flex-col",children:[(0,b.jsxs)(d.CardHeader,{className:"p-4 border-b border-border/50",children:[(0,b.jsx)(d.CardTitle,{className:"text-xl",children:"Messages"}),(0,b.jsxs)("div",{className:"relative mt-2",children:[(0,b.jsx)(h.Search,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(e.Input,{placeholder:"Search messages...",className:"pl-8"})]})]}),(0,b.jsx)(d.CardContent,{className:"p-0 flex-1 overflow-y-auto",children:u?(0,b.jsx)("div",{className:"flex justify-center p-8",children:(0,b.jsx)(k.Loader2,{className:"animate-spin h-6 w-6 text-muted-foreground"})}):0===q.length?(0,b.jsx)("div",{className:"p-8 text-center text-muted-foreground",children:"No conversations yet"}):q.map(c=>(0,b.jsx)("div",{onClick:()=>n(c.id),className:`p-4 border-b border-border/50 cursor-pointer hover:bg-secondary/20 transition-colors ${a===c.id?"bg-primary/5":""}`,children:(0,b.jsxs)("div",{className:"flex items-start gap-3",children:[(0,b.jsxs)(g.Avatar,{children:[(0,b.jsx)(g.AvatarImage,{src:c.otherUser?.avatar_url}),(0,b.jsx)(g.AvatarFallback,{children:c.otherUser?.full_name?.[0]||"U"})]}),(0,b.jsxs)("div",{className:"flex-1 overflow-hidden",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,b.jsx)("span",{className:"font-medium",children:c.otherUser?.full_name||"User"}),(0,b.jsx)("span",{className:"text-xs text-muted-foreground",children:c.lastMessage?new Date(c.lastMessage.created_at).toLocaleDateString():""})]}),(0,b.jsxs)("p",{className:"text-sm truncate text-muted-foreground",children:[c.listing?.title&&(0,b.jsxs)("span",{className:"font-semibold mr-1",children:["[",c.listing.title,"]"]}),c.lastMessage?.content||"No messages"]})]})]})},c.id))})]}),(0,b.jsx)(d.Card,{className:"glass-card flex-1 flex flex-col",children:a?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"p-4 border-b border-border/50 flex items-center gap-3",children:[(0,b.jsxs)(g.Avatar,{children:[(0,b.jsx)(g.AvatarImage,{src:C?.avatar_url}),(0,b.jsx)(g.AvatarFallback,{children:C?.full_name?.[0]||"U"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold",children:C?.full_name||"User"}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground"})]})]}),(0,b.jsxs)("div",{className:"flex-1 p-4 overflow-y-auto space-y-4",children:[w?(0,b.jsx)("div",{className:"flex justify-center py-10",children:(0,b.jsx)(k.Loader2,{className:"animate-spin h-8 w-8 text-primary"})}):0===s.length?(0,b.jsx)("div",{className:"text-center text-muted-foreground py-10",children:"No messages yet. Say hi!"}):s.map(a=>{let c=a.sender_id===y?.id;return(0,b.jsx)("div",{className:`flex ${c?"justify-end":"justify-start"}`,children:(0,b.jsx)("div",{className:`rounded-lg p-3 max-w-[80%] text-sm ${c?"bg-primary text-primary-foreground":"bg-secondary"}`,children:a.content})},a.id)}),(0,b.jsx)("div",{ref:A})]}),(0,b.jsx)("div",{className:"p-4 border-t border-border/50",children:(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsx)(e.Input,{placeholder:"Type a message...",value:o,onChange:a=>p(a.target.value),onKeyDown:a=>"Enter"===a.key&&B()}),(0,b.jsx)(f.Button,{size:"icon",onClick:B,children:(0,b.jsx)(i.Send,{className:"h-4 w-4"})})]})})]}):(0,b.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center text-muted-foreground",children:[(0,b.jsx)(j.User,{className:"h-12 w-12 mb-4 opacity-50"}),(0,b.jsx)("p",{children:"Select a chat to start messaging"})]})})]})}a.s(["MessagesPage",()=>n])}];

//# sourceMappingURL=_29843c00._.js.map