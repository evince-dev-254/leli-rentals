{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/evince/Downloads/greeting%20%281%29/lib/supabase-admin.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js'\r\n\r\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!\r\nconst supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY!\r\n\r\nexport const supabaseAdmin = createClient(supabaseUrl, supabaseServiceRoleKey, {\r\n    auth: {\r\n        autoRefreshToken: false,\r\n        persistSession: false\r\n    }\r\n})\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM;AACN,MAAM,yBAAyB,QAAQ,GAAG,CAAC,yBAAyB;AAE7D,MAAM,gBAAgB,IAAA,uLAAY,EAAC,aAAa,wBAAwB;IAC3E,MAAM;QACF,kBAAkB;QAClB,gBAAgB;IACpB;AACJ"}},
    {"offset": {"line": 22, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/evince/Downloads/greeting%20%281%29/lib/actions/affiliate-actions.ts"],"sourcesContent":["\"use server\"\r\n\r\nimport { supabase } from \"@/lib/supabase\"\r\nimport { supabaseAdmin } from \"@/lib/supabase-admin\"\r\n\r\n// ... existing joinAffiliateProgram ...\r\n\r\nexport async function getAllAffiliates() {\r\n    const { data, error } = await supabaseAdmin\r\n        .from('affiliates')\r\n        .select(`\r\n            *,\r\n            user_profiles:user_id (\r\n                full_name,\r\n                email,\r\n                avatar_url,\r\n                account_status\r\n            )\r\n        `)\r\n        .order('created_at', { ascending: false })\r\n\r\n    if (error) {\r\n        console.error('Error fetching all affiliates:', error)\r\n        return []\r\n    }\r\n\r\n    return data\r\n}\r\n\r\n\r\nexport async function joinAffiliateProgram(userId: string, email: string) {\r\n    // 1. Check if affiliate already exists for this user or email\r\n    const { data: existingAffiliate, error: findError } = await supabaseAdmin\r\n        .from('affiliates')\r\n        .select('*')\r\n        .or(`user_id.eq.${userId},email.eq.${email}`)\r\n        .single();\r\n\r\n    if (existingAffiliate) {\r\n        // Already exists, just ensure role is updated and return success\r\n        // Update user role to affiliate if not already\r\n        await supabaseAdmin\r\n            .from('user_profiles')\r\n            .update({ role: 'affiliate' })\r\n            .eq('id', userId);\r\n\r\n        return { success: true, data: existingAffiliate };\r\n    }\r\n\r\n    // Generate codes\r\n    const inviteCode = Math.random().toString(36).substring(2, 10).toUpperCase();\r\n    const referralCode = `REF-${inviteCode}`;\r\n\r\n    // Create affiliate record using Admin client to bypass RLS\r\n    const { data, error } = await supabaseAdmin\r\n        .from('affiliates')\r\n        .insert({\r\n            user_id: userId,\r\n            email: email,\r\n            invite_code: inviteCode,\r\n            referral_code: referralCode,\r\n            status: 'active', // Auto-activate\r\n            commission_rate: 10.00\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n    if (error) {\r\n        console.error('Error joining affiliate program:', error);\r\n        return { success: false, error: error.message };\r\n    }\r\n\r\n    // Ensure user role is affiliate\r\n    const { error: roleError } = await supabaseAdmin\r\n        .from('user_profiles')\r\n        .update({ role: 'affiliate' })\r\n        .eq('id', userId);\r\n\r\n    if (roleError) {\r\n        console.error('Error updating role:', roleError);\r\n    }\r\n\r\n    return { success: true, data };\r\n}\r\n"],"names":[],"mappings":";;;;;;;AAGA;;;;AAIO,eAAe;IAClB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,yIAAa,CACtC,IAAI,CAAC,cACL,MAAM,CAAC,CAAC;;;;;;;;QAQT,CAAC,EACA,KAAK,CAAC,cAAc;QAAE,WAAW;IAAM;IAE5C,IAAI,OAAO;QACP,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO,EAAE;IACb;IAEA,OAAO;AACX;AAGO,eAAe,qBAAqB,MAAc,EAAE,KAAa;IACpE,8DAA8D;IAC9D,MAAM,EAAE,MAAM,iBAAiB,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,yIAAa,CACpE,IAAI,CAAC,cACL,MAAM,CAAC,KACP,EAAE,CAAC,CAAC,WAAW,EAAE,OAAO,UAAU,EAAE,OAAO,EAC3C,MAAM;IAEX,IAAI,mBAAmB;QACnB,iEAAiE;QACjE,+CAA+C;QAC/C,MAAM,yIAAa,CACd,IAAI,CAAC,iBACL,MAAM,CAAC;YAAE,MAAM;QAAY,GAC3B,EAAE,CAAC,MAAM;QAEd,OAAO;YAAE,SAAS;YAAM,MAAM;QAAkB;IACpD;IAEA,iBAAiB;IACjB,MAAM,aAAa,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,SAAS,CAAC,GAAG,IAAI,WAAW;IAC1E,MAAM,eAAe,CAAC,IAAI,EAAE,YAAY;IAExC,2DAA2D;IAC3D,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,yIAAa,CACtC,IAAI,CAAC,cACL,MAAM,CAAC;QACJ,SAAS;QACT,OAAO;QACP,aAAa;QACb,eAAe;QACf,QAAQ;QACR,iBAAiB;IACrB,GACC,MAAM,GACN,MAAM;IAEX,IAAI,OAAO;QACP,QAAQ,KAAK,CAAC,oCAAoC;QAClD,OAAO;YAAE,SAAS;YAAO,OAAO,MAAM,OAAO;QAAC;IAClD;IAEA,gCAAgC;IAChC,MAAM,EAAE,OAAO,SAAS,EAAE,GAAG,MAAM,yIAAa,CAC3C,IAAI,CAAC,iBACL,MAAM,CAAC;QAAE,MAAM;IAAY,GAC3B,EAAE,CAAC,MAAM;IAEd,IAAI,WAAW;QACX,QAAQ,KAAK,CAAC,wBAAwB;IAC1C;IAEA,OAAO;QAAE,SAAS;QAAM;IAAK;AACjC;;;IA5EsB;IAuBA;;AAvBA,+OAAA;AAuBA,+OAAA"}},
    {"offset": {"line": 107, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/evince/Downloads/greeting%20%281%29/.next-internal/server/app/admin/affiliates/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {getAllAffiliates as '00ffb2132d27b65ae9cb4c4d7869d5d76be031738f'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}