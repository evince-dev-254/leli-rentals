(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,70065,e=>{"use strict";var s=e.i(43476),a=e.i(47163);function t({className:e,...t}){return(0,s.jsx)("div",{"data-slot":"card",className:(0,a.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...t})}function r({className:e,...t}){return(0,s.jsx)("div",{"data-slot":"card-header",className:(0,a.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-2 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...t})}function l({className:e,...t}){return(0,s.jsx)("div",{"data-slot":"card-title",className:(0,a.cn)("leading-none font-semibold",e),...t})}function n({className:e,...t}){return(0,s.jsx)("div",{"data-slot":"card-description",className:(0,a.cn)("text-muted-foreground text-sm",e),...t})}function c({className:e,...t}){return(0,s.jsx)("div",{"data-slot":"card-content",className:(0,a.cn)("px-6",e),...t})}e.s(["Card",()=>t,"CardContent",()=>c,"CardDescription",()=>n,"CardHeader",()=>r,"CardTitle",()=>l])},84614,e=>{"use strict";let s=(0,e.i(75254).default)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);e.s(["User",()=>s],84614)},31278,e=>{"use strict";let s=(0,e.i(75254).default)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>s],31278)},14764,e=>{"use strict";let s=(0,e.i(75254).default)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);e.s(["Send",()=>s],14764)},36639,e=>{"use strict";var s=e.i(43476),a=e.i(71645),t=e.i(70065),r=e.i(23750),l=e.i(67881),n=e.i(63270),c=e.i(55436),i=e.i(14764),d=e.i(84614),o=e.i(31278),x=e.i(17927),m=e.i(27158);function u(){let[e,u]=(0,a.useState)(null),[f,h]=(0,a.useState)(""),[g,p]=(0,a.useState)([]),[j,v]=(0,a.useState)([]),[b,N]=(0,a.useState)(!0),[y,w]=(0,a.useState)(!1),[C,S]=(0,a.useState)(null),_=(0,a.useRef)(null);(0,a.useEffect)(()=>{_.current?.scrollIntoView({behavior:"smooth"})},[j]),(0,a.useEffect)(()=>{!async function(){try{let{data:{user:e}}=await x.supabase.auth.getUser();if(S(e),e){let s=await (0,m.getConversations)(e.id);p(s||[])}}catch(e){console.error("Error fetching chats:",e)}finally{N(!1)}}()},[]),(0,a.useEffect)(()=>{if(!e)return;!async function(){w(!0);try{let s=await (0,m.getMessages)(e);v(s||[])}catch(e){console.error("Error fetching messages:",e)}finally{w(!1)}}();let s=x.supabase.channel(`conversation:${e}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`conversation_id=eq.${e}`},e=>{v(s=>[...s,e.new])}).subscribe();return()=>{x.supabase.removeChannel(s)}},[e]);let U=async()=>{if(f.trim()&&e&&C)try{let s={id:"temp-"+Date.now(),content:f,sender_id:C.id,created_at:new Date().toISOString(),is_read:!1};v(e=>[...e,s]),h(""),await (0,m.sendMessage)(e,C.id,s.content)}catch(e){console.error("Error sending message:",e)}},k=g.find(s=>s.id===e)?.otherUser;return(0,s.jsxs)("div",{className:"h-[calc(100vh-8rem)] flex flex-col md:flex-row gap-6",children:[(0,s.jsxs)(t.Card,{className:"glass-card w-full md:w-80 flex flex-col",children:[(0,s.jsxs)(t.CardHeader,{className:"p-4 border-b border-border/50",children:[(0,s.jsx)(t.CardTitle,{className:"text-xl",children:"Messages"}),(0,s.jsxs)("div",{className:"relative mt-2",children:[(0,s.jsx)(c.Search,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,s.jsx)(r.Input,{placeholder:"Search messages...",className:"pl-8"})]})]}),(0,s.jsx)(t.CardContent,{className:"p-0 flex-1 overflow-y-auto",children:b?(0,s.jsx)("div",{className:"flex justify-center p-8",children:(0,s.jsx)(o.Loader2,{className:"animate-spin h-6 w-6 text-muted-foreground"})}):0===g.length?(0,s.jsx)("div",{className:"p-8 text-center text-muted-foreground",children:"No conversations yet"}):g.map(a=>(0,s.jsx)("div",{onClick:()=>u(a.id),className:`p-4 border-b border-border/50 cursor-pointer hover:bg-secondary/20 transition-colors ${e===a.id?"bg-primary/5":""}`,children:(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsxs)(n.Avatar,{children:[(0,s.jsx)(n.AvatarImage,{src:a.otherUser?.avatar_url}),(0,s.jsx)(n.AvatarFallback,{children:a.otherUser?.full_name?.[0]||"U"})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-hidden",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,s.jsx)("span",{className:"font-medium",children:a.otherUser?.full_name||"User"}),(0,s.jsx)("span",{className:"text-xs text-muted-foreground",children:a.lastMessage?new Date(a.lastMessage.created_at).toLocaleDateString():""})]}),(0,s.jsxs)("p",{className:"text-sm truncate text-muted-foreground",children:[a.listing?.title&&(0,s.jsxs)("span",{className:"font-semibold mr-1",children:["[",a.listing.title,"]"]}),a.lastMessage?.content||"No messages"]})]})]})},a.id))})]}),(0,s.jsx)(t.Card,{className:"glass-card flex-1 flex flex-col",children:e?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"p-4 border-b border-border/50 flex items-center gap-3",children:[(0,s.jsxs)(n.Avatar,{children:[(0,s.jsx)(n.AvatarImage,{src:k?.avatar_url}),(0,s.jsx)(n.AvatarFallback,{children:k?.full_name?.[0]||"U"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"font-semibold",children:k?.full_name||"User"}),(0,s.jsx)("div",{className:"text-xs text-muted-foreground"})]})]}),(0,s.jsxs)("div",{className:"flex-1 p-4 overflow-y-auto space-y-4",children:[y?(0,s.jsx)("div",{className:"flex justify-center py-10",children:(0,s.jsx)(o.Loader2,{className:"animate-spin h-8 w-8 text-primary"})}):0===j.length?(0,s.jsx)("div",{className:"text-center text-muted-foreground py-10",children:"No messages yet. Say hi!"}):j.map(e=>{let a=e.sender_id===C?.id;return(0,s.jsx)("div",{className:`flex ${a?"justify-end":"justify-start"}`,children:(0,s.jsx)("div",{className:`rounded-lg p-3 max-w-[80%] text-sm ${a?"bg-primary text-primary-foreground":"bg-secondary"}`,children:e.content})},e.id)}),(0,s.jsx)("div",{ref:_})]}),(0,s.jsx)("div",{className:"p-4 border-t border-border/50",children:(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(r.Input,{placeholder:"Type a message...",value:f,onChange:e=>h(e.target.value),onKeyDown:e=>"Enter"===e.key&&U()}),(0,s.jsx)(l.Button,{size:"icon",onClick:U,children:(0,s.jsx)(i.Send,{className:"h-4 w-4"})})]})})]}):(0,s.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center text-muted-foreground",children:[(0,s.jsx)(d.User,{className:"h-12 w-12 mb-4 opacity-50"}),(0,s.jsx)("p",{children:"Select a chat to start messaging"})]})})]})}e.s(["MessagesPage",()=>u])}]);